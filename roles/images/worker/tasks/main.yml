- name: get image list
  shell: "kubeadm config images list --image-repository {{ KUBE_IMAGE_REPO }} 2>/dev/null
    | grep -e coredns -e kube-proxy -e pause
    | sed -e 's#{{ KUBE_IMAGE_REPO }}/coredns#docker.io/coredns/coredns#g'"
  register: worker_images
  changed_when: False
  run_once: true

- name: pull images
  docker_image:
    name: "{{ item }}"
    source: pull
    state: present
  loop: "{{ worker_images.stdout_lines | list }}"
  when: KUBE_CRI == "docker"
 
- name: pull images
  shell: "ctr images pull {{ item }}"
  loop: "{{ master_images.stdout_lines | list }}"
  when: KUBE_CRI == "containerd"
